
uniform int				constraint_results_size;
uniform samplerBuffer	constraint_results;

uniform isamplerBuffer	transfer_indices;

attribute vec3 vel;
attribute vec3 rot;

varying vec3 out_vel;
varying vec3 out_rot;

void main()
{
	int transfer_index = texelFetch(transfer_indices, gl_VertexID).x;

	if(transfer_index == 0)
	{
		out_vel = vel;
		out_rot = rot;
	}
	else
	{
		--transfer_index;
		if(transfer_index % 2 == 0)
		{
			transfer_index /= 2;

			out_vel = texelFetch(constraint_results, transfer_index + constraint_results_size * 2);
			out_rot = texelFetch(constraint_results, transfer_index + constraint_results_size * 0);
		}
		else
		{
			transfer_index /= 2;
			out_vel = texelFetch(constraint_results, transfer_index + constraint_results_size * 3);
			out_rot = texelFetch(constraint_results, transfer_index + constraint_results_size * 1);
		}
	}
}
